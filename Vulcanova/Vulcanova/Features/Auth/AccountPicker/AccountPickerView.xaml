<layout:ReactiveSheetPage
    x:TypeArguments="accountPicker:AccountPickerViewModel" xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:xct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:accounts="clr-namespace:Vulcanova.Features.Auth.Accounts;assembly=Vulcanova"
    xmlns:views="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:resx="clr-namespace:Vulcanova.Resources;assembly=Vulcanova"
    xmlns:layout="clr-namespace:Vulcanova.Core.Layout;assembly=Vulcanova"
    xmlns:auth="clr-namespace:Vulcanova.Features.Auth;assembly=Vulcanova"
    xmlns:accountPicker="clr-namespace:Vulcanova.Features.Auth.AccountPicker;assembly=Vulcanova"
    xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
    xmlns:vulcanovaIos="clr-namespace:Vulcanova.Core.Layout.PlatformSpecific.iOS;assembly=Vulcanova"
    vulcanovaIos:Sheet.HasCloseButton="False"
    ios:Page.UseSafeArea="True"
    x:Class="Vulcanova.Features.Auth.AccountPicker.AccountPickerView"
    x:Name="View">
    <layout:ReactiveSheetPage.Resources>
        <accounts:PupilToInitialsConverter x:Key="PupilToInitialsConverter" />
        <auth:LoginRoleDisplayConverter x:Key="LoginRoleDisplayConverter" />
    </layout:ReactiveSheetPage.Resources>
    <ContentView.Content>
        <StackLayout>
            <Label Style="{StaticResource TitleLabelStyle}" HorizontalOptions="FillAndExpand"
                   Padding="16, 16, 16, 0"
                   LineBreakMode="TailTruncation"
                   Text="{x:Static resx:Strings.AccountPickerTitle}" />
            <CollectionView BindingContext="{x:Reference View}" ItemsSource="{Binding ViewModel.AvailableAccounts}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="accounts:Account">
                        <SwipeView>
                            <SwipeView.LeftItems>
                                <SwipeItems>
                                    <SwipeItemView
                                        BackgroundColor="{AppThemeBinding Light={StaticResource LightErrorColor}, Dark={StaticResource DarkErrorColor}}"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type accountPicker:AccountPickerViewModel}}, Path=DeleteAccount}"
                                        CommandParameter="{Binding Id}">
                                        <StackLayout VerticalOptions="Center"
                                                     Spacing="0"
                                                     BackgroundColor="{AppThemeBinding Light={StaticResource LightErrorColor}, Dark={StaticResource DarkErrorColor}}">
                                            <layout:TintedCachedImage
                                                BackgroundColor="{AppThemeBinding Light={StaticResource LightErrorColor}, Dark={StaticResource DarkErrorColor}}"
                                                HeightRequest="24"
                                                WidthRequest="24"
                                                Margin="30, 0"
                                                Source="resource://Vulcanova.Resources.Icons.trash-outline.svg"
                                                TintColor="{StaticResource DarkPrimaryTextColor}" />
                                            <Label HorizontalTextAlignment="Center"
                                                   FontSize="Small"
                                                   TextColor="{StaticResource DarkPrimaryTextColor}"
                                                   Text="{x:Static resx:Strings.CommonDelete}" />
                                        </StackLayout>
                                    </SwipeItemView>
                                </SwipeItems>
                            </SwipeView.LeftItems>
                            <Grid ColumnSpacing="12"
                                  Padding="16, 8"
                                  xct:TouchEffect.NormalBackgroundColor="{AppThemeBinding Light={StaticResource LightBackgroundColor}, Dark={StaticResource DarkBackgroundColor}}"
                                  xct:TouchEffect.PressedBackgroundColor="{AppThemeBinding Light={StaticResource LightBorderColor}, Dark={StaticResource DarkBorderColor}}"
                                  xct:TouchEffect.Command="{Binding Source={x:Reference View}, Path=ViewModel.OpenAccount}"
                                  xct:TouchEffect.CommandParameter="{Binding Id}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <views:AvatarView
                                    VerticalOptions="Center"
                                    Text="{Binding Pupil, Converter={StaticResource PupilToInitialsConverter}}"
                                    Color="{AppThemeBinding Dark={StaticResource DarkTranslucentPrimaryColor}, Light={StaticResource LightTranslucentPrimaryColor}}"
                                    TextColor="{AppThemeBinding Dark={StaticResource DarkPrimaryColor}, Light={StaticResource LightPrimaryColor}}" />
                                <StackLayout Grid.Column="1" Spacing="0" Background="Transparent">
                                    <Label>
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0} {1}{2}">
                                                <Binding Path="Pupil.FirstName" />
                                                <Binding Path="Pupil.Surname" />
                                                <Binding Path="Login.LoginRole"
                                                         Converter="{StaticResource LoginRoleDisplayConverter}" />
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>
                                    <Label
                                        FontSize="Small"
                                        TextColor="{AppThemeBinding Dark={StaticResource DarkSecondaryTextColor}, Light={StaticResource LightSecondaryTextColor}}">
                                        <Label.Text>
                                            <MultiBinding StringFormat="{}{0} â€“ {1}">
                                                <Binding Path="Unit.Short" />
                                                <Binding Path="ClassDisplay" />
                                            </MultiBinding>
                                        </Label.Text>
                                    </Label>
                                </StackLayout>
                                <layout:TintedCachedImage
                                    Grid.Column="2"
                                    IsVisible="{Binding IsActive}"
                                    HeightRequest="35"
                                    WidthRequest="35"
                                    Source="resource://Vulcanova.Resources.Icons.checkmark-circle.svg"
                                    TintColor="{AppThemeBinding Light={StaticResource LightPrimaryColor}, Dark={StaticResource DarkPrimaryColor}}" />
                            </Grid>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <Button Command="{Binding Source={x:Reference View}, Path=ViewModel.OpenAddAccountPage}"
                    Style="{StaticResource DefaultButtonStyle}"
                    Text="{x:Static resx:Strings.AddNewAccountButton}"
                    Margin="16, 0" />
        </StackLayout>
    </ContentView.Content>
</layout:ReactiveSheetPage>