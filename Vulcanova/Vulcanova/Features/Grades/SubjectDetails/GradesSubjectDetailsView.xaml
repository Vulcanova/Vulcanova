<?xml version="1.0" encoding="utf-8"?>

<forms:ContentView xmlns:forms="http://xamarin.com/schemas/2014/forms" xmlns="http://xamarin.com/schemas/2014/forms"
                   xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
                   xmlns:grades="clr-namespace:Vulcanova.Features.Grades;assembly=Vulcanova"
                   xmlns:layout="clr-namespace:Vulcanova.Core.Layout;assembly=Vulcanova"
                   xmlns:resx="clr-namespace:Vulcanova.Resources;assembly=Vulcanova"
                   x:Class="Vulcanova.Features.Grades.SubjectDetails.GradesSubjectDetailsView"
                   x:Name="View">
    <ContentView.Resources>
        <ResourceDictionary>
            <grades:GradeColorConverter x:Key="GradeColorConverter" />
            <layout:FallbackStringConverter x:Key="FallbackStringConverter" />
            <Style ApplyToDerivedTypes="true" TargetType="StackLayout">
                <Setter Property="BackgroundColor"
                        Value="{AppThemeBinding Light={StaticResource LightPanelColor}, Dark={StaticResource DarkPanelColor}}" />
            </Style>
        </ResourceDictionary>
    </ContentView.Resources>
    <ContentPage.Content>
        <StackLayout BindingContext="{x:Reference View}">
            <StackLayout Orientation="Horizontal" Padding="16, 8">
                <Label Style="{StaticResource MediumLabelStyle}" HorizontalOptions="FillAndExpand"
                       Text="{Binding Subject.SubjectName}" />
                <Label Text="{Binding Subject.Average, StringFormat='{0:F2}'}" />
            </StackLayout>
            <CollectionView BindingContext="{x:Reference View}" ItemsSource="{Binding Subject.Grades}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="grades:Grade">
                        <StackLayout Padding="0, 1">
                            <StackLayout Orientation="Horizontal" Padding="12, 8">
                                <Label
                                    WidthRequest="40"
                                    VerticalTextAlignment="Center"
                                    HorizontalTextAlignment="Center"
                                    FontSize="Large"
                                    TextColor="{Binding Column.Color, Converter={StaticResource GradeColorConverter}}"
                                    Text="{Binding Content}" />
                                <Grid RowSpacing="0">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="*" />
                                        <RowDefinition Height="*" />
                                    </Grid.RowDefinitions>
                                    <Label FontSize="Small" FontAttributes="Bold"
                                           Text="{Binding Column.Name, Converter={StaticResource FallbackStringConverter}, ConverterParameter={x:Static resx:Strings.GradeEmptyNameLabel}}" />
                                    <StackLayout Grid.Row="1" Orientation="Horizontal">
                                        <Label Text="{Binding ContentRaw}" FontSize="Small" />
                                        <Label FontSize="Small"
                                               Text="{Binding Column.Weight, StringFormat={x:Static resx:Strings.GradeWeightLabel}}" />
                                    </StackLayout>
                                    <StackLayout Grid.Row="2" Orientation="Horizontal">
                                        <Label FontSize="Small"
                                               Text="{Binding DateCreated, StringFormat={x:Static resx:Strings.GradeCreatedDateLabel}}" />
                                        <Label FontSize="Small" IsVisible="{Binding IsModified}"
                                               Text="{Binding DateModify, StringFormat={x:Static resx:Strings.GradeModifiedDateLabel}}" />
                                    </StackLayout>
                                </Grid>
                            </StackLayout>
                            <BoxView Style="{StaticResource SeparatorStyle}" />
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>
    </ContentPage.Content>
</forms:ContentView>